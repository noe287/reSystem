<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>IPTABLES-EBTABLES</title>
</head><body><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">Iptables </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># Connect a LAN to the internet </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">------------------------ </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">$&gt; iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">This command can be explained in the following way: </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">iptables:           the command line utility for configuring the kernel </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">-t nat           select table &quot;nat&quot; for configuration of NAT rules. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">-A POSTROUTING           Append a rule to the POSTROUTING chain (-A stands for &quot;append&quot;). </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">-o eth1           this rule is valid for packets that leave on the second network interface (-o stands for &quot;output&quot;) </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">-j MASQUERADE           the action that should take place is to 'masquerade' packets, i.e. replacing the sender's address by the router's address. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">Some further comments on the above command instruction: packets generated by the router itself are masked as well because they pass the POSTROUTING chain too! (see illustration further above) However, since the kernel tries to keep the source ports unchanged and processes running on the router acquire free ports only, locally generated packets usually remain unchanged, although the rule is executed. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">------------------------------------------------------------------------------------------------------------------------------------------------------ </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># actions to be taken on matched packets </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # will be abbreviated by '[...]'. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # Depending on the match pattern the appropriate chain is selected. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # TCP packets from 192.168.1.2: </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables -t nat -A POSTROUTING -p tcp -s 192.168.1.2 [...] </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # UDP packets to 192.168.1.2: </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables -t nat -A POSTROUTING -p udp -d 192.168.1.2 [...] </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # all packets from 192.168.x.x arriving at eth0: </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables -t nat -A PREROUTING -s 192.168.0.0/16 -i eth0 [...] </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # all packets except TCP packets and except packets from 192.168.1.2: </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables -t nat -A PREROUTING -p ! tcp -s ! 192.168.1.2 [...] </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">     </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # packets leaving at eth1: </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables -t nat -A POSTROUTING -o eth1 [...] </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # TCP packets from 192.168.1.2, port 12345 to 12356 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # to 123.123.123.123, Port 22 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # (a backslash indicates contination at the next line) </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables -t nat -A POSTROUTING -p tcp -s 192.168.1.2 \ </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">       --sport 12345:12356 -d 123.123.123.123 --dport 22 [...] </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">We are already able to select desired packets, all that is left is an appropriate action. For the nat-table only the actions SNAT, MASQUERADE, DNAT and REDIRECT, all of them with preceeding '-j', are meaningful. Their exact meaning will be explained in the subsequent section. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # In the following the table selection, the command and the match pattern </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # will be abbreviated using [...] </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # Source-NAT: Change sender to 123.123.123.123 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables [...] -j SNAT --to-source 123.123.123.123 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # Mask: Change sender to outgoing network interface </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables [...] -j MASQUERADE </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # Destination-NAT: Change receipient to 123.123.123.123, port 22 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables [...] -j DNAT --to-destination 123.123.123.123:22 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    # Redirect to local port 8080 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    $&gt; iptables [...] -j REDIRECT --to-ports 8080 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">------------------------------------------------------------------------------------------------------------------------------------------------------ </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">ip -s neighbor show </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">sudo ip -s -s neigh flush all </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">IPTABLES </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">---------------------------------- </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -F </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -X </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -t nat -F </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -t nat -X </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -t mangle -F </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -t mangle -X </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -P INPUT ACCEPT </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -P OUTPUT ACCEPT </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -P FORWARD ACCEPT </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">Where, </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    -F : Deleting (flushing) all the rules. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    -X : Delete chain. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    -t table_name : Select table (called nat or mangle) and delete/flush rules. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">    -P : Set the default policy (such as DROP, REJECT, or ACCEPT). </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">--------------------------------- </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">iptables -L -v -n  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">--------------------------------- </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">iptables -A INPUT -j DROP -s &quot;stb_ip&quot; -m physdev --physdev-in wl1 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">---------------------------------------------------- </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">WAN yapma komutu Karaca'dan. </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># brctl delif br0 eth0 </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># ifconfig eth0 172.16.x.y up </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># route add default gw 172.16.0.z </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># ping 4.2.2.4 &lt;--- Bu noktada ping atabiliyor olmalı </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -t filter -F </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"># iptables -t nat -A POSTROUTING -j MASQUERADE </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">--------------------------------------------------------------------------------- </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">Iptables Links: </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.digitalocean.com/community/tutorials/how-to-test-your-firewall-configuration-with-nmap-and-tcpdump">https://www.digitalocean.com/community/tutorials/how-to-test-your-firewall-configuration-with-nmap-and-tcpdump</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands">https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-iptables-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-iptables-on-ubuntu-14-04</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.digitalocean.com/community/tutorials/a-deep-dive-into-iptables-and-netfilter-architecture">https://www.digitalocean.com/community/tutorials/a-deep-dive-into-iptables-and-netfilter-architecture</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#TRAVERSINGGENERAL">https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html#TRAVERSINGGENERAL</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.slideshare.net/PrzemysawPiotrowski1/basics-of-firewall-ebtables-arptables-and-iptables">https://www.slideshare.net/PrzemysawPiotrowski1/basics-of-firewall-ebtables-arptables-and-iptables</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.karlrupp.net/en/computer/nat_tutorial">https://www.karlrupp.net/en/computer/nat_tutorial</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt">  </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://wiki.debian.org/BridgeNetworkConnections#Bridging_with_a_wireless_NIC">https://wiki.debian.org/BridgeNetworkConnections#Bridging_with_a_wireless_NIC</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"><a href="https://wiki.archlinux.org/index.php/Network_bridge">https://wiki.archlinux.org/index.php/Network_bridge</a> </span></span><br/>
</div><br/>
<div style="text-align: left"><span style="font-family: Calibri"><span style="font-size: 11pt"> </span></span><br/>
</div></body></html>